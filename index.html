<!DOCTYPE html>

<head lang="es-AR">
	<title>🎃 Cuándo se libera Andy???</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&family=Rubik+Wet+Paint&display=swap" rel="stylesheet">
	<style>
		body {
			margin: 0;
			padding: 1em;
			height: 100vh;
			overflow: hidden;
			background-color: black;
			color: white;
			font-size: xxx-large;
			font-family: "Rubik Wet Paint", "Noto Color Emoji", monospace, sans-serif;
			text-align: center;
		}

		.yay {
			color: green;
		}

		.boo {
			color: red;
		}

		#message {
			z-index: 2;
		}

		@keyframes clock {
			0% {
				transform: scale(var(--scale));
			}

			100% {
				transform: scale(1);
			}
		}

		#counter {
			display: inline-block;
			z-index: 1;
		}

		#counter.start {
			animation: clock 1s infinite ease-out;
		}

		.content {
			display: inline-grid;
			grid-template-rows: .5fr 1fr .5fr;
		}

		.party {
			display: grid;
			grid-template-columns: 1fr 1fr;
		}

		@keyframes party {
			0% {
				transform: rotateY(var(--rotate)) translateX(var(--translate))
			}

			100% {
				transform: rotateY(var(--rotate)) translateX(var(--translate)) scale(1.2)
			}
		}

		@keyframes sad {
			0% {
				transform: initial
			}

			25% {
				transform: scale(1.05) skew(var(--rotate))
			}

			50% {
				transform: initial
			}

			75% {
				transform: scale(1.05) skew(calc(-1 * var(--rotate)));
			}

			100% {
				transform: initial
			}
		}

		.yay+.party .icon {
			--rotate: 0deg;
			--translate: 0%;
		}

		.yay+.party .icon.right {
			--rotate: 180deg;
			--translate: -100%;
		}

		.boo+.party .icon {
			--rotate: -10deg;
		}

		.boo+.party .icon.right {
			--rotate: 10deg;
		}

		.party {
			z-index: 0
		}

		.icon::before {
			display: inline-block;
			transform-origin: 0 100%;
		}

		.yay+.party .icon::before {
			animation: party alternate .25s ease-out infinite;
		}

		.boo+.party .icon::before {
			animation: sad forwards 1s linear infinite;
			transform-origin: 50% 100%;
		}

		.yay+.party .icon::before {
			content: '🎉';
		}

		.boo+.party .icon::before {
			content: '😭';
		}
	</style>
	<script>
		const msInADay = 24 * 60 * 60 * 1000;
		const shiftLength = 4 * msInADay;
		const startDate = new Date(2024, 0, 2, 18, 0, 0);
		let millis = false;
		let extraDays = 0;
		addEventListener('keydown', ev => {
			switch (ev.key) {
				case ' ':
					millis = !millis;
					break;
				case '+':
					extraDays++;
					break;
				case '-':
					extraDays--;
					break;
			}
		})

		function pad(value) {
			return value.toString().padStart(2, '0');
		}

		function sigmoid(seconds) {
			const normalized = 1 - seconds / (4 * 24 * 60 * 60);
			const sigmoid = Math.tanh(normalized);
			const scaled = sigmoid + 1;
			console.log(seconds, normalized, sigmoid, scaled)
			return scaled;
		}

		function updateCountdown() {
			const now = new Date();
			now.setDate(now.getDate() + extraDays);
			const elapsed = now - startDate;
			const cycleTime = elapsed % (shiftLength * 2);

			let targetDate, statusMessage, remainingSeconds;
			if (cycleTime < shiftLength) {
				targetDate = new Date(now.getTime() + (shiftLength - cycleTime));
				remainingSeconds = Math.floor((targetDate - now) / 1000);
				const days = Math.floor((targetDate - now) / msInADay);
				const name = targetDate.toLocaleDateString('es-AR', { weekday: 'long' })
				statusMessage = `Andy no está! 🪏<br>Se libera el ${name} 🤩`
				className = 'boo';
			} else {
				targetDate = new Date(now.getTime() + (2 * shiftLength - cycleTime));
				remainingSeconds = Math.floor((targetDate - now) / 1000);
				const days = Math.floor((targetDate - now) / msInADay);
				const name = targetDate.toLocaleDateString('es-AR', { weekday: 'long' })
				statusMessage = `Andy está libre! 😄<br>Nos abandona el ${name} 😔`
				className = 'yay';
			}

			const remainingTime = targetDate - now;
			const days = Math.floor(remainingTime / msInADay);
			const hours = Math.floor((remainingTime % msInADay) / (60 * 60 * 1000));
			const minutes = Math.floor((remainingTime % (60 * 60 * 1000)) / (60 * 1000));
			const seconds = Math.floor((remainingTime % (60 * 1000)) / 1000);
			const milliseconds = millis ? `.${remainingTime % 1000}` : '';

			document.getElementById('date').innerHTML =
				`🎃Hoy es ${now.toLocaleDateString('es-AR', { dateStyle: 'full' })}🎃`;
			document.getElementById('message').className = className;
			document.getElementById('status').innerHTML = statusMessage;
			const counter = document.getElementById('counter');
			counter.innerHTML = `${pad(days)}:${pad(hours)}:${pad(minutes)}:${pad(seconds)}${milliseconds}`;

			counter.style.setProperty('--scale', sigmoid(remainingSeconds));

			requestAnimationFrame(updateCountdown);
		}
		requestAnimationFrame(updateCountdown);

		const now = new Date();
		const delay = 1000 - now.getMilliseconds();
		setTimeout(() => {
			const counter = document.getElementById('counter');
			counter.classList.add('start');
		}, delay);

	</script>
</head>

<body>
	<script>0</script>
	<div class="content">
		<p id="date"></p>
		<span id="message">
			<span id="status"></span>
			<br />
			<span id="counter"></span>
		</span>
		<span class="party">
			<span class="icon"></span>
			<span class="icon right"></span>
		</span>
	</div>
</body>